import type { Video } from './types';
import { USE_MOCKS, API_BASE_URL, authHeaders, store, mockId, delay, now } from './api-core';

export async function getVideos(summaryId: string): Promise<Video[]> { if (USE_MOCKS) { await delay(); return store.videos.filter(v => v.summary_id === summaryId); } return (await (await fetch(`${API_BASE_URL}/summaries/${summaryId}/videos`, { headers: authHeaders() })).json()).data; }
export async function createVideo(summaryId: string, video: Partial<Video>): Promise<Video> { if (USE_MOCKS) { await delay(); const n: Video = { id: mockId('vid'), summary_id: summaryId, title: video.title || 'Novo Video', url: video.url || '', duration_ms: video.duration_ms, thumbnail_url: video.thumbnail_url || null, order_index: video.order_index ?? store.videos.filter(v => v.summary_id === summaryId).length, created_at: now(), updated_at: now(), created_by: 'demo-user' }; store.videos.push(n); return n; } return (await (await fetch(`${API_BASE_URL}/summaries/${summaryId}/videos`, { method: 'POST', headers: authHeaders(), body: JSON.stringify(video) })).json()).data; }
export async function updateVideo(summaryId: string, videoId: string, data: Partial<Video>): Promise<Video> { if (USE_MOCKS) { await delay(); const i = store.videos.findIndex(v => v.id === videoId); if (i === -1) throw new Error(`Video ${videoId} not found`); store.videos[i] = { ...store.videos[i], ...data, updated_at: now() }; return store.videos[i]; } return (await (await fetch(`${API_BASE_URL}/summaries/${summaryId}/videos/${videoId}`, { method: 'PUT', headers: authHeaders(), body: JSON.stringify(data) })).json()).data; }
export async function deleteVideo(summaryId: string, videoId: string): Promise<void> { if (USE_MOCKS) { await delay(); store.videos = store.videos.filter(v => v.id !== videoId); return; } await fetch(`${API_BASE_URL}/summaries/${summaryId}/videos/${videoId}`, { method: 'DELETE', headers: authHeaders() }); }
